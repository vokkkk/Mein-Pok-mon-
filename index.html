<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pok√©-ZA Open World Engine</title>
    <style>
        :root { --accent: #00e5ff; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        #viewport { width: 100vw; height: 100vh; perspective: 1000px; overflow: hidden; }
        
        /* Die Welt */
        #world { 
            position: absolute; width: 20000px; height: 20000px; 
            background: #1a472a; 
            background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 100px 100px;
            transform-style: preserve-3d;
            transition: transform 0.1s linear;
        }

        /* Objekte */
        .entity { position: absolute; transform-origin: bottom; transform: rotateX(-45deg); display: flex; flex-direction: column; align-items: center; }
        .poke-sprite { font-size: 40px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5)); }
        .hp-mini { width: 30px; height: 4px; background: #333; border: 1px solid #fff; margin-top: 2px; }
        .hp-fill { width: 100%; height: 100%; background: #0f0; }

        /* Spieler */
        #player { position: absolute; top: 50%; left: 50%; font-size: 50px; transform: translate(-50%, -100%) rotateX(-45deg); z-index: 1000; }

        /* UI */
        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border-left: 4px solid var(--accent); z-index: 2000; pointer-events: none; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; padding: 20px; box-sizing: border-box; z-index: 3000; }
        .btn { background: rgba(255,255,255,0.1); border: 2px solid #fff; border-radius: 50%; color: #fff; height: 70px; width: 70px; display: flex; align-items: center; justify-content: center; font-size: 30px; backdrop-filter: blur(5px); margin: auto; }
        
        #battle-screen { position: absolute; inset: 0; background: #000; z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>

<div id="viewport">
    <div id="world"></div>
    <div id="player">üßç</div>
</div>

<div id="ui">
    <b>LEVEL: <span id="p-lv">5</span></b> | <span id="p-name">Glumanda</span><br>
    <small>INV: <span id="p-inv">B√§lle: 20</span></small>
</div>

<div class="controls">
    <div></div><div class="btn" onmousedown="startMove(0,100)" onmouseup="stopMove()">‚ñ≤</div><div></div>
    <div class="btn" onmousedown="startMove(100,0)" onmouseup="stopMove()">‚óÄ</div>
    <div class="btn" style="border-color: #ffcc00;" onclick="tryCatch()">üî¥</div>
    <div class="btn" onmousedown="startMove(-100,0)" onmouseup="stopMove()">‚ñ∂</div>
    <div></div><div class="btn" onmousedown="startMove(0,-100)" onmouseup="stopMove()">‚ñº</div><div></div>
</div>

<script>
    // --- DATENBANK ---
    const DB = {
        "Glumanda": { icon: "üî•", evo: { target: "Glutexo", lv: 16 } },
        "Bisasam": { icon: "üçÉ", evo: { target: "Bisaknosp", lv: 16 } },
        "Schiggy": { icon: "üê¢", evo: { target: "Schillok", lv: 16 } },
        "Pikachu": { icon: "‚ö°", evo: { target: "Raichu", item: "Donnerstein" } }
    };

    // --- VARIABLEN ---
    let posX = -10000, posY = -10000;
    let lv = 5, xp = 0, balls = 20;
    let activeMon = "Glumanda";
    let entities = []; // "Server"-Daten
    let moveInterval;

    // Welt-Generierung (Simulierter Server-Input)
    for(let i=0; i<1000; i++) {
        entities.push({
            id: i,
            x: Math.random() * 19000 + 500,
            y: Math.random() * 19000 + 500,
            name: Object.keys(DB)[Math.floor(Math.random()*4)],
            isLoaded: false,
            dom: null
        });
    }

    // --- LOGIK ---
    function startMove(dx, dy) {
        if(moveInterval) return;
        moveInterval = setInterval(() => {
            posX += dx * 0.5;
            posY += dy * 0.5;
            render();
        }, 20);
    }

    function stopMove() {
        clearInterval(moveInterval);
        moveInterval = null;
    }

    function render() {
        const world = document.getElementById('world');
        world.style.transform = `rotateX(45deg) translate(${posX}px, ${posY}px)`;
        
        const viewDist = 800; // Radius f√ºr Ressourcen-Streaming
        const centerX = Math.abs(posX);
        const centerY = Math.abs(posY);

        entities.forEach(e => {
            const dist = Math.sqrt((e.x - centerX)**2 + (e.y - centerY)**2);
            
            if(dist < viewDist && !e.isLoaded) {
                // Instanziierung (Objekt erstellen)
                const div = document.createElement('div');
                div.className = 'entity';
                div.innerHTML = `<span class="poke-sprite">${DB[e.name].icon}</span><div class="hp-mini"><div class="hp-fill"></div></div>`;
                div.style.left = e.x + "px";
                div.style.top = e.y + "px";
                world.appendChild(div);
                e.dom = div;
                e.isLoaded = true;
            } else if(dist > viewDist && e.isLoaded) {
                // L√∂schen (Ressourcen sparen)
                e.dom.remove();
                e.dom = null;
                e.isLoaded = false;
            }
        });
    }

    function tryCatch() {
        if(balls <= 0) return alert("Keine B√§lle!");
        const centerX = Math.abs(posX);
        const centerY = Math.abs(posY);
        
        // Finde das n√§chste Pok√©mon im Umkreis
        const target = entities.find(e => e.isLoaded && Math.sqrt((e.x - centerX)**2 + (e.y - centerY)**2) < 150);
        
        if(target) {
            balls--;
            if(Math.random() > 0.4) {
                alert(target.name + " gefangen!");
                xp += 50;
                checkEvo();
                target.dom.remove();
                entities = entities.filter(ent => ent.id !== target.id);
            } else {
                alert("Entwischt!");
            }
        }
        updateUI();
    }

    function checkEvo() {
        if(xp >= 100) {
            lv++; xp = 0;
            const evo = DB[activeMon].evo;
            if(evo && evo.lv && lv >= evo.lv) {
                alert("WAS?! " + activeMon + " entwickelt sich!");
                activeMon = evo.target;
            }
        }
    }

    function updateUI() {
        document.getElementById('p-lv').innerText = lv;
        document.getElementById('p-name').innerText = activeMon;
        document.getElementById('p-inv').innerText = "B√§lle: " + balls;
    }

    render();
</script>
</body>
</html>
