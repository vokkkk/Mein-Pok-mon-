<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pok√©-Open-World Engine</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #viewport { width: 100vw; height: 100vh; perspective: 1000px; }
        #world { 
            position: absolute; width: 10000px; height: 10000px; 
            background: #2d5a27; transform-style: preserve-3d;
            transition: transform 0.1s linear;
        }
        .chunk-grid {
            position: absolute; width: 100%; height: 100%;
            background-image: grid; /* Simuliert Sektoren */
        }
        #player {
            position: absolute; top: 50%; left: 50%; font-size: 40px;
            transform: translate(-50%, -50%) rotateX(-30deg); z-index: 1000;
        }
        .entity {
            position: absolute; transform: rotateX(-45deg);
            font-size: 30px; transition: opacity 0.5s;
        }
        #stats {
            position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7);
            color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace;
        }
    </style>
</head>
<body>

<div id="viewport">
    <div id="world" id="map"></div>
    <div id="player">üö∂‚Äç‚ôÇÔ∏è</div>
</div>

<div id="stats">
    Position: <span id="pos">0, 0</span><br>
    Geladene Objekte: <span id="obj-count">0</span>
</div>

<script>
    let posX = -5000, posY = -5000;
    const world = document.getElementById('world');
    
    // UNSER "SERVER" (Datenbank von 500 festen Pok√©mon-Positionen)
    const serverData = [];
    for(let i=0; i<500; i++) {
        serverData.push({
            id: i,
            x: Math.random() * 9000 + 500,
            y: Math.random() * 9000 + 500,
            type: ["üî•", "üíß", "üçÉ", "‚ö°"][Math.floor(Math.random()*4)],
            isLoaded: false,
            element: null
        });
    }

    function updateWorld() {
        let loadedCount = 0;
        const viewDistance = 600; // Nur Objekte im Umkreis von 600px laden

        serverData.forEach(p => {
            // Berechne Distanz zum Spieler
            const dx = p.x - Math.abs(posX);
            const dy = p.y - Math.abs(posY);
            const distance = Math.sqrt(dx*dx + dy*dy);

            if(distance < viewDistance && !p.isLoaded) {
                // SPAWN (Server schickt Daten -> Handy baut Modell)
                const el = document.createElement('div');
                el.className = 'entity';
                el.innerHTML = p.type;
                el.style.left = p.x + "px";
                el.style.top = p.y + "px";
                world.appendChild(el);
                p.element = el;
                p.isLoaded = true;
            } else if(distance > viewDistance && p.isLoaded) {
                // DESPAWN (Handy l√∂scht Modell, um RAM zu sparen)
                p.element.remove();
                p.isLoaded = false;
            }

            if(p.isLoaded) loadedCount++;
        });

        document.getElementById('pos').innerText = `${Math.floor(Math.abs(posX))}, ${Math.floor(Math.abs(posY))}`;
        document.getElementById('obj-count').innerText = loadedCount;
    }

    // Steuerung
    window.addEventListener('keydown', (e) => {
        if(e.key === "ArrowUp") posY += 50;
        if(e.key === "ArrowDown") posY -= 50;
        if(e.key === "ArrowLeft") posX += 50;
        if(e.key === "ArrowRight") posX -= 50;
        
        world.style.transform = `rotateX(45deg) translate(${posX}px, ${posY}px)`;
        updateWorld();
    });

    // Touch-Support f√ºr Mobile
    let startY = 0;
    window.addEventListener('touchstart', e => startY = e.touches[0].pageY);
    window.addEventListener('touchmove', e => {
        let diff = startY - e.touches[0].pageY;
        posY -= diff * 0.1;
        world.style.transform = `rotateX(45deg) translate(${posX}px, ${posY}px)`;
        updateWorld();
    });

    updateWorld(); // Initialer Check
</script>
</body>
</html>
